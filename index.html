<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Diplomat's Lounge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Inline favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%230058ff'/%3E%3Ctext x='16' y='21' text-anchor='middle' font-family='Arial' font-size='16' fill='white'%3EDL%3C/text%3E%3C/svg%3E">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <!-- Firebase v9 SDK (modular) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js';
    import { 
      getFirestore, 
      doc, setDoc, getDoc, updateDoc,
      onSnapshot, runTransaction, collection
    } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDeL3u1VfeXIE6-_XNvT9EHmcmorVb-Pvk",
      authDomain: "diplomats-lounge.firebaseapp.com",
      projectId: "diplomats-lounge",
      storageBucket: "diplomats-lounge.firebasestorage.app",
      messagingSenderId: "358973240719",
      appId: "1:358973240719:web:fa24ea1f6234af10f987fa"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.firebaseDb = db;
    window.firebaseDoc = doc;
    window.firebaseSetDoc = setDoc;
    window.firebaseGetDoc = getDoc;
    window.firebaseUpdateDoc = updateDoc;
    window.firebaseOnSnapshot = onSnapshot;
    window.firebaseRunTransaction = runTransaction;
    window.firebaseCollection = collection;
  </script>

  <style>
    :root{
      --bg:#ffffff; --ink:#0f1720; --muted:#5b6472;
      --blue:#055aff; --good:#079455; --bad:#e11d48;
      --ring:#e8edf4; --shadow:rgba(16,24,40,.08);
      --stage-max: 900px;
      --stage-width: 340px;
      --map-height: 300px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      display:flex; flex-direction:column; align-items:center;
    }

    /* Header */
    header{
      width:100%; max-width:var(--stage-max);
      padding:10px 16px 2px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      flex-wrap: wrap;
    }
    .brand{font-weight:800; letter-spacing:.06em}
    .pill{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--ring); border-radius:999px; padding:8px 12px; box-shadow:0 3px 10px var(--shadow); background:#fff; font-weight:800; font-size:14px}
    .btn{border:1px solid var(--ring); border-radius:10px; padding:10px 14px; font-weight:800; cursor:pointer; background:#f6faff; font-size: 14px;}
    .btn.primary{background:var(--blue); color:#fff; border-color:var(--blue)}
    .btn:disabled{opacity:.55; cursor:not-allowed}
    .btn:hover:not(:disabled) { opacity: 0.9; }
    .header-right{display:flex; gap:8px; align-items:center}

    /* Stage (smaller) */
    main{ width:100%; max-width:var(--stage-max); padding:6px 16px 16px; display:flex; flex-direction:column; align-items:center; gap:8px }
    .stage{ width:min(100%, var(--stage-width)); position:relative; aspect-ratio: 16 / 11; border-radius:22px; overflow:hidden; background:#f0f0f0 }
    .stage img{ width:100%; height:100%; object-fit:cover; display:block; filter:saturate(1.02) }
    .stage-placeholder { 
      width:100%; height:100%; display:flex; align-items:center; justify-content:center; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; font-size: 24px; font-weight: 800;
    }

    .faces{ position:absolute; inset:0; pointer-events:none }

    /* Bubbles */
    .bubble{
      position:absolute; padding:6px 10px; border-radius:10px; background:#111827; color:#fff;
      font-size:12px; font-weight:700; opacity:0; transform:translate(-50%,-8px); transition:opacity .16s ease, transform .16s ease;
      white-space:nowrap; pointer-events:none; z-index: 10;
    }
    .bubble.show{ opacity:1; transform:translate(-50%,-14px) }
    #bubK{ left:24%; top:24% }
    #bubC{ left:78%; top:24% }

    /* Controls */
    .controls{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
      border:1px solid var(--ring); border-radius:999px; padding:6px 8px;
      box-shadow:0 8px 24px var(--shadow); background:#fff;
    }
    .ctl{display:flex; align-items:center; gap:8px}
    .ctl input[type="number"]{
      width:86px; padding:8px 10px; border-radius:999px; border:1px solid var(--ring); text-align:center; font-weight:800
    }

    .bankRow{ 
      display:flex; gap:12px; justify-content:center; align-items:center; 
      font-weight:800; flex-wrap: wrap; font-size: 18px; 
    }
    .you{ color:var(--good) } 
    .opp{ color:var(--bad) }
    .zero { color: var(--muted) }

    /* Cards + maps */
    .arena{ width:100%; display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top: 8px; }
    .card{ border:1px solid var(--ring); background:#fff; border-radius:16px; padding:12px; box-shadow:0 8px 24px var(--shadow); cursor: pointer; transition: all 0.2s; position: relative;}
    .card:hover { transform: translateY(-2px); box-shadow:0 12px 32px var(--shadow); }
    .card.picked-k { border: 3px solid var(--good); }
    .card.picked-c { border: 3px solid var(--bad); }
    .picker-badge { position: absolute; top: -10px; right: 16px; padding: 4px 12px; border-radius: 999px; font-size: 12px; font-weight: 800; color: white; }
    .picker-badge.k { background: var(--good); }
    .picker-badge.c { background: var(--bad); }
    .line{ font-weight:800; letter-spacing:.04em; font-size: 16px; }
    .eta{ color:var(--muted); font-weight:700; font-size:14px; margin-top: 4px; }
    .progress{ margin-top:8px; height:10px; background:#f3f6fb; border:1px solid var(--ring); border-radius:999px; overflow:hidden }
    .bar{ height:100%; width:0%; background:linear-gradient(90deg,#19a0ff,#a8eaff); transition: width 0.1s ease; }
    .map{ margin-top:10px; height:var(--map-height); border-radius:12px; overflow:hidden; border:1px solid var(--ring) }
    .log{ text-align:center; font-weight:800; border:1px solid var(--ring); background:#fff; border-radius:14px; padding:12px; box-shadow:0 8px 24px var(--shadow); font-size: 16px; }

    /* Error banner */
    .error-banner {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: #fee2e2; color: #7f1d1d; padding: 12px 20px; border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,.12); z-index: 9999; font-size: 14px; max-width: 90%; text-align: center;
    }

    @media (max-width:860px){
      .arena{ grid-template-columns:1fr }
      header { justify-content: center; }
      :root{ --map-height: 240px; --stage-width: 300px; }
      .header-right{ flex-wrap: wrap; justify-content: center; }
    }

    /* Face animation */
    .eye{ transition: transform .12s ease }
    .blink{ transform: scaleY(0.05) }
    .mouth{ transform-origin:50% 50%; transition: all .15s ease }
    .talk{ transform: scaleY(1.8) scaleX(0.8) }
    .smile{ transform: scaleY(1.5) scaleX(1.2) }
    .frown{ transform: scaleY(0.6) scaleX(1.1) }

    /* ===== Kapow FX ===== */
    .kapow {
      position: fixed; inset: 0;
      display: grid; place-items: center;
      pointer-events: none; z-index: 4000;
      animation: kapowFade 1.35s ease-in forwards;
    }
    .kapow svg { width: 100vw; height: 100vh; }
    .kapow .burst { animation: kapowPop 220ms cubic-bezier(.17,.67,.35,1.35) both; }
    .kapow .word { font-weight: 900; letter-spacing: .06em; fill: #fff; }
    .kapow .sub  { font-weight: 800; fill: #073b4c; opacity: .9; }

    @keyframes kapowPop {
      0%   { transform: scale(.65) rotate(-8deg); filter: saturate(1.1); }
      100% { transform: scale(1)   rotate(0deg); }
    }
    @keyframes kapowFade {
      0% { opacity: 0; }
      10% { opacity: 1; }
      75% { opacity: 1; }
      100% { opacity: 0; }
    }
  </style>
</head>
<body class="compact">
  <header>
    <div class="brand">Diplomat's Lounge</div>
    <div class="header-right">
      <div class="pill" id="seatPill" title="Your seat">Seat: <strong id="seatName">Solo</strong></div>
      <!-- Live status pill: game.js will update this element's text/background -->
      <div class="pill" id="connection-status">ðŸŸ¢ Live</div>
      <button id="newRoom" class="btn">New room</button>
      <button id="copyLink" class="btn">Copy invite</button>
    </div>
  </header>

  <main>
    <!-- Stage -->
    <div class="stage" id="stage">
      <div class="stage-placeholder"><span>Diplomat's Lounge</span></div>

      <!-- Bubbles -->
      <div class="bubble" id="bubK"></div>
      <div class="bubble" id="bubC"></div>

      <!-- Faces -->
      <svg class="faces" viewBox="0 0 1152 768" preserveAspectRatio="xMidYMid slice" style="display:none;">
        <!-- Left person (seat K) -->
        <g id="K" transform="translate(408, 258)">
          <ellipse id="K_eyeL" class="eye" cx="-30" cy="0" rx="11" ry="11" fill="#1b2230"/>
          <ellipse id="K_eyeR" class="eye" cx="30"  cy="0" rx="11" ry="11" fill="#1b2230"/>
          <rect id="K_mouth" class="mouth" x="-22" y="38" width="44" height="14" rx="7" fill="#1b2230"/>
        </g>
        <!-- Right person (seat C) -->
        <g id="C" transform="translate(777, 270)">
          <ellipse id="C_eyeL" class="eye" cx="-28" cy="0" rx="11" ry="11" fill="#1b2230"/>
          <ellipse id="C_eyeR" class="eye" cx="28"  cy="0" rx="11" ry="11" fill="#1b2230"/>
          <rect id="C_mouth" class="mouth" x="-22" y="38" width="44" height="14" rx="7" fill="#1b2230"/>
        </g>
      </svg>
    </div>

    <!-- Controls -->
    <div class="controls">
      <div class="ctl">
        <div class="pill" id="autoAirport">Airport: <strong>â€”</strong></div>
      </div>
      <div class="ctl"><span>Bet</span><input id="betIn" type="number" value="50" step="25" min="25" /></div>
      <div class="ctl"><button id="deal" class="btn primary">Deal flights</button></div>
      <div class="ctl"><button id="reset" class="btn">Reset bank</button></div>
    </div>

    <div class="bankRow">
      <!-- K (left) is Cajun; C (right) is Kessler -->
      <span><span id="nameK">Cajun</span>: <span id="bankK" class="zero">$0</span></span>
      <span>Â·</span>
      <span><span id="nameC">Kessler</span>: <span id="bankC" class="zero">$0</span></span>
      <span style="display:block; width:100%; font-size:14px; color:var(--muted); margin-top:6px;">
        First to +$5,000 (while opponent is -$5,000) wins!
      </span>
    </div>

    <!-- Arena -->
    <div class="arena">
      <div class="card" id="A">
        <div class="line" id="lineA">A â€” waitingâ€¦</div>
        <div class="eta" id="etaA"></div>
        <div class="progress"><div class="bar" id="barA"></div></div>
        <div class="map" id="mapA"></div>
      </div>
      <div class="card" id="B">
        <div class="line" id="lineB">B â€” waitingâ€¦</div>
        <div class="eta" id="etaB"></div>
        <div class="progress"><div class="bar" id="barB"></div></div>
        <div class="map" id="mapB"></div>
      </div>
      <div class="log" id="log">Welcome to the Diplomat's Lounge. Deal flights to start.</div>
    </div>
  </main>

  <script src="./game.js" type="module"></script>
</body>
</html>
