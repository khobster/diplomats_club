<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Diplomat's Lounge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Inline favicon (avoids GH Pages 404s) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%230058ff'/%3E%3Ctext x='16' y='21' text-anchor='middle' font-family='Arial' font-size='16' fill='white'%3EDL%3C/text%3E%3C/svg%3E">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800&display=swap" rel="stylesheet">

  <!-- Leaflet (mini-maps) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <!-- Firebase v9 SDK (modular) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js';
    import { 
      getFirestore, 
      doc, 
      setDoc, 
      getDoc, 
      updateDoc,
      onSnapshot,
      runTransaction,
      collection
    } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js';

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDeL3u1VfeXIE6-_XNvT9EHmcmorVb-Pvk",
      authDomain: "diplomats-lounge.firebaseapp.com",
      projectId: "diplomats-lounge",
      storageBucket: "diplomats-lounge.firebasestorage.app",
      messagingSenderId: "358973240719",
      appId: "1:358973240719:web:fa24ea1f6234af10f987fa"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Make Firebase functions available globally
    window.firebaseDb = db;
    window.firebaseDoc = doc;
    window.firebaseSetDoc = setDoc;
    window.firebaseGetDoc = getDoc;
    window.firebaseUpdateDoc = updateDoc;
    window.firebaseOnSnapshot = onSnapshot;
    window.firebaseRunTransaction = runTransaction;
    window.firebaseCollection = collection;
  </script>

  <style>
    :root{
      --bg:#ffffff; --ink:#0f1720; --muted:#5b6472;
      --blue:#055aff; --good:#079455; --bad:#e11d48;
      --ring:#e8edf4; --shadow:rgba(16,24,40,.08);
      --stage-max: 820px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      display:flex; flex-direction:column; align-items:center;
    }

    /* Header */
    header{
      width:100%; max-width:var(--stage-max);
      padding:12px 16px 4px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      flex-wrap: wrap;
    }
    .brand{font-weight:800; letter-spacing:.06em}
    .pill{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--ring); border-radius:999px; padding:8px 12px; box-shadow:0 3px 10px var(--shadow)}
    .btn{border:1px solid var(--ring); border-radius:10px; padding:10px 14px; font-weight:800; cursor:pointer; background:#f6faff; font-size: 14px;}
    .btn.primary{background:var(--blue); color:#fff; border-color:var(--blue)}
    .btn:disabled{opacity:.55; cursor:not-allowed}
    .btn:hover:not(:disabled) { opacity: 0.9; }

    /* Stage */
    main{ width:100%; max-width:var(--stage-max); padding:8px 16px 24px; display:flex; flex-direction:column; align-items:center; gap:12px }
    .stage{ width:min(100%, 780px); position:relative; aspect-ratio: 3 / 2; border-radius:22px; overflow:hidden; background: #f0f0f0; }
    .stage img{ width:100%; height:100%; object-fit:cover; display:block; filter:saturate(1.02) }
    .stage-placeholder { 
      width:100%; 
      height:100%; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 24px;
      font-weight: 800;
    }

    /* Face overlay (scales with image) */
    .faces{ position:absolute; inset:0; pointer-events:none }

    /* Bubbles */
    .bubble{
      position:absolute; padding:6px 10px; border-radius:10px; background:#111827; color:#fff;
      font-size:12px; font-weight:700; opacity:0; transform:translate(-50%,-8px); transition:opacity .16s ease, transform .16s ease;
      white-space:nowrap; pointer-events:none; z-index: 10;
    }
    .bubble.show{ opacity:1; transform:translate(-50%,-14px) }
    #bubK{ left:24%; top:24% }
    #bubC{ left:78%; top:24% }

    /* Controls */
    .controls{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
      border:1px solid var(--ring); border-radius:999px; padding:6px 8px;
      box-shadow:0 8px 24px var(--shadow); background:#fff;
    }
    .ctl{display:flex; align-items:center; gap:8px}
    .ctl input[type="text"], .ctl input[type="number"]{
      width:86px; padding:8px 10px; border-radius:999px; border:1px solid var(--ring); text-align:center; font-weight:800
    }
    .bankRow{ display:flex; gap:12px; justify-content:center; align-items:center; font-weight:800; flex-wrap: wrap; }
    .you{ color:var(--good) } .opp{ color:var(--bad) }

    /* Cards + maps */
    .arena{ width:100%; display:grid; grid-template-columns:1fr 1fr; gap:14px }
    .card{ border:1px solid var(--ring); background:#fff; border-radius:16px; padding:12px; box-shadow:0 8px 24px var(--shadow); cursor: pointer; transition: transform 0.2s; }
    .card:hover { transform: translateY(-2px); box-shadow:0 12px 32px var(--shadow); }
    .line{ font-weight:800; letter-spacing:.04em }
    .eta{ color:var(--muted); font-weight:700; font-size:13px }
    .progress{ margin-top:10px; height:10px; background:#f3f6fb; border:1px solid var(--ring); border-radius:999px; overflow:hidden }
    .bar{ height:100%; width:0%; background:linear-gradient(90deg,#19a0ff,#a8eaff); transition: width 0.1s ease; }
    .map{ margin-top:10px; height:150px; border-radius:12px; overflow:hidden; border:1px solid var(--ring) }
    .log{ text-align:center; font-weight:800; border:1px solid var(--ring); background:#fff; border-radius:14px; padding:12px; box-shadow:0 8px 24px var(--shadow) }

    /* Error banner */
    .error-banner {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #fee2e2;
      color: #7f1d1d;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,.12);
      z-index: 9999;
      font-size: 14px;
      max-width: 90%;
      text-align: center;
    }

    @media (max-width:860px){
      .arena{ grid-template-columns:1fr }
      header { justify-content: center; }
    }

    /* Face animation */
    .eye{ transition: transform .12s ease }
    .blink{ transform: scaleY(0.05) }
    .mouth{ transform-origin:50% 50%; transition: transform .08s ease }
    .talk{ animation: talk .22s ease-in-out infinite }
    @keyframes talk { 0%{ transform:scaleY(0.7) } 50%{ transform:scaleY(1.25) } 100%{ transform:scaleY(0.9) } }
  </style>
</head>
<body>
  <header>
    <div class="brand">Diplomat's Lounge</div>
    <div class="pill" id="seatPill" title="Your seat">Seat: <strong id="seatName">Solo</strong></div>
    <div style="display:flex; gap:8px">
      <button id="newRoom" class="btn">New room</button>
      <button id="copyLink" class="btn">Copy invite</button>
    </div>
  </header>

  <main>
    <!-- Centerpiece stage -->
    <div class="stage" id="stage">
      <div class="stage-placeholder">
        <span>Diplomat's Lounge</span>
      </div>
      
      <!-- Speech bubbles -->
      <div class="bubble" id="bubK"></div>
      <div class="bubble" id="bubC"></div>

      <!-- Overlay SVG aligned to the PNG (viewBox from your asset) -->
      <svg class="faces" viewBox="0 0 1152 768" preserveAspectRatio="xMidYMid slice" style="display:none;">
        <!-- Kessler -->
        <g id="K" transform="translate(408, 258)">
          <ellipse id="K_eyeL" class="eye" cx="-30" cy="0" rx="11" ry="11" fill="#1b2230"/>
          <ellipse id="K_eyeR" class="eye" cx="30"  cy="0" rx="11" ry="11" fill="#1b2230"/>
          <rect id="K_mouth" class="mouth" x="-22" y="38" width="44" height="14" rx="7" fill="#1b2230"/>
        </g>

        <!-- Cajun -->
        <g id="C" transform="translate(777, 270)">
          <ellipse id="C_eyeL" class="eye" cx="-28" cy="0" rx="11" ry="11" fill="#1b2230"/>
          <ellipse id="C_eyeR" class="eye" cx="28"  cy="0" rx="11" ry="11" fill="#1b2230"/>
          <rect id="C_mouth" class="mouth" x="-22" y="38" width="44" height="14" rx="7" fill="#1b2230"/>
        </g>
      </svg>
    </div>

    <!-- Controls -->
    <div class="controls">
      <div class="ctl">
        <label style="display:flex;align-items:center;gap:6px"><input id="liveToggle" type="checkbox"> LIVE</label>
        <input id="airport" type="text" maxlength="4" value="JFK" placeholder="IATA" />
      </div>
      <div class="ctl"><span>Bet</span><input id="betIn" type="number" value="50" step="25" min="25" /></div>
      <div class="ctl"><button id="deal" class="btn primary">Deal flights</button></div>
      <div class="ctl"><button id="reset" class="btn">Reset bank</button></div>
    </div>

    <div class="bankRow">
      <span>Kessler: <span id="bankK" class="you">500 sirignanos</span></span>
      <span>·</span>
      <span>Cajun: <span id="bankC" class="opp">2,000 sirignanos</span></span>
    </div>

    <!-- Arena -->
    <div class="arena">
      <div class="card" id="A">
        <div class="line" id="lineA">A — waiting…</div>
        <div class="eta" id="etaA"></div>
        <div class="progress"><div class="bar" id="barA"></div></div>
        <div class="map" id="mapA"></div>
      </div>
      <div class="card" id="B">
        <div class="line" id="lineB">B — waiting…</div>
        <div class="eta" id="etaB"></div>
        <div class="progress"><div class="bar" id="barB"></div></div>
        <div class="map" id="mapB"></div>
      </div>
      <div class="log" id="log">Welcome to the Diplomat's Lounge. Deal flights to start.</div>
    </div>
  </main>

  <script src="./game-fixed.js" type="module"></script>
</body>
</html>
